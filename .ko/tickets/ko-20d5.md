---
id: ko-20d5
status: closed
deps: []
links: []
created: 2026-02-17T03:38:00Z
type: task
priority: 2
---
# Step timeout â€” enforce max duration per pipeline node with configurable default

## Problem

`ko build` has no timeout on individual pipeline steps. If the agent enters
plan mode, waits for interactive input, or just spins, the build hangs
indefinitely. A 6-hour implement step was observed in production (exo-6de5)
where the agent likely entered plan mode and stalled.

## Design

Add a `step_timeout` config key to pipeline.yml with a reasonable default
(e.g., 15 minutes). Individual nodes can override.

```yaml
step_timeout: 15m   # default for all nodes

workflows:
  main:
    - name: triage
      type: decision
      prompt: triage.md
      timeout: 5m       # override for this node
    - name: implement
      type: action
      prompt: implement.md
      timeout: 30m      # implementation may need more time
```

In `runPromptNode`, use `exec.CommandContext` with a deadline derived from
the timeout. When the context expires, the process is killed and the step
fails with a clear error ("step timed out after 15m").

## Acceptance Criteria

- [ ] Pipeline-level `step_timeout` sets a default for all nodes
- [ ] Per-node `timeout` overrides the default
- [ ] Default timeout is 15 minutes if not specified
- [ ] Timed-out steps kill the agent process and report a clear error
- [ ] `run:` nodes (shell commands) also respect the timeout
- [ ] Timeout is logged so it's diagnosable in the event log

## Notes

**2026-02-24 12:39:35 UTC:** ko: reset to open (agent stopped)
