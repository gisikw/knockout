---
id: ko-6f77
status: blocked
deps: []
created: 2026-02-25T23:17:36Z
type: task
priority: 2
---
# Add --project flag, strip hashtag auto-detection from add

Commands that need --project (no ticket ID to derive context from): add, ls, ready, agent loop, agent init, agent start, agent stop, agent status. Also strip RouteTicket hashtag parsing from title in ko add — use --project exclusively. Implementation: modify resolveProjectTicketsDir() to accept an optional --project flag value.

## Notes

**2026-02-26 00:34:38 UTC:** ko: FAIL at node 'verify' — node 'verify' failed after 3 attempts: command failed: exit status 1
initialized .ko/config.yaml
  .ko/prompts/triage.md
  .ko/prompts/implement.md
  .ko/prompts/review.md
ko agent init: /tmp/TestCmdBuildInit_refusesOverwrite584300741/001/.ko/config.yaml already exists
initialized .ko/config.yaml
  .ko/prompts/triage.md
  .ko/prompts/implement.md
  .ko/prompts/review.md
test-fcb3
test-a19a
test-d799
test-2be1
test-907a
test-4fdc
test-c1a0
test-810b
test-0cca
test-7a56
test-5e1d
test-b3d9
test-2afd
test-bfb2
ko project: subcommand required (set, ls)
Usage:
  ko project set #<tag> [--prefix=p] [--default]
  ko project ls
ko project: unknown subcommand 'unknown'
Valid subcommands: set, ls
project test registered
project test initialized with prefix "tst" and registered
project test registered and set as default
project test initialized with prefix "tst" and registered
project test initialized with prefix "new", registered, and set as default
project test registered
ko project set: #tag argument required
Usage: ko project set #<tag> [--prefix=p] [--default]
ko project set: prefix must be at least 2 characters
no projects registered
  proj1	/path/to/proj1
* proj2	/path/to/proj2
  proj3	/path/to/proj3
  proj1	/path/to/proj1
* proj2	/path/to/proj2
--- FAIL: TestProjectRegistry (0.00s)
    --- FAIL: TestProjectRegistry/add_multitag (0.02s)
        testscript.go:584: # Multiple tags: first routes, rest are labels (0.000s)
            # Register target project (0.005s)
            # Add with multiple tags (0.006s)
            # Verify ticket in target has extra tags as labels (0.005s)
            > env TICKETS_DIR=$WORK/target/.ko/tickets
            > exec ko ls --json --status=routed
            [stdout]
            null
            > stdout 'Refactor auth'
            FAIL: testdata/project_registry/add_multitag.txtar:17: no match for `Refactor auth` found in stdout
            
    --- FAIL: TestProjectRegistry/add_captured (0.02s)
        testscript.go:584: # Add with unrecognized tag goes to default project as captured (0.000s)
            # Register default project and set as default (0.005s)
            # Add with unrecognized tag (0.007s)
            # Verify ticket in default project with status captured and tag preserved (0.005s)
            > env TICKETS_DIR=$WORK/default-proj/.ko/tickets
            > exec ko ls --json --status=captured
            [stdout]
            null
            > stdout 'Build splash page'
            FAIL: testdata/project_registry/add_captured.txtar:17: no match for `Build splash page` found in stdout
            
    --- FAIL: TestProjectRegistry/add_routed (0.01s)
        testscript.go:584: # Add with recognized tag routes to target project (0.000s)
            # Register target project (0.004s)
            # Add a routed ticket (0.006s)
            > exec ko add 'Fix the thing #target'
            [stdout]
            ko-71c8
            > stdout '#target'
            FAIL: testdata/project_registry/add_routed.txtar:13: no match for `#target` found in stdout
            
FAIL
FAIL	git.gisi.network/infra/knockout	6.137s
FAIL

