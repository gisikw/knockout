# Test ko ls --json output (JSON array format)
exec ko ls --json
stdout '^\['
stdout '"id": "json-0001"'
stdout '"title": "First JSON ticket"'
stdout '"status": "open"'
stdout '"priority": 2'
stdout '"hasUnresolvedDep": false'
stdout '"hasUnresolvedDep": true'
stdout '^\]'

# Test ko ls --limit flag works (output should have exactly 1 line)
exec ko ls --limit 1
stdout -count=1 '\[open\]'

# Test ko ls --json --limit combined (output should have exactly 1 ticket object)
exec ko ls --json --limit 1
stdout -count=1 '"id":'

# Test ko ready --json output (JSON array format)
exec ko ready --json
stdout '^\['
stdout '"id": "json-0001"'
stdout '"title": "First JSON ticket"'
stdout '"hasUnresolvedDep": false'
stdout '^\]'

# Test ko ready --limit flag (output should have exactly 1 line)
exec ko ready --limit 1
stdout -count=1 '\[open\]'

# Test ko blocked --json output with blocked ticket (JSON array format)
exec ko blocked --json
stdout '^\['
stdout '"id": "json-0002"'
stdout '"deps": \['
stdout '"json-0003"'
stdout '"hasUnresolvedDep": true'
stdout '^\]'

# Test ko blocked --limit flag
exec ko ls --status blocked
exec ko blocked --limit 1
stdout 'json-0002'

# Test ko ls --status=closed --json output (JSON array format)
exec ko close json-0003
exec ko ls --status=closed --json
stdout '^\['
stdout '"id": "json-0003"'
stdout '"status": "closed"'
stdout '"hasUnresolvedDep": false'
stdout '^\]'

# Test ko ls --status=closed --limit flag (already existed, verify it still works)
exec ko close json-0001
exec ko ls --status=closed --limit 1
stdout 'json-0001'
! stdout 'json-0003'

# Test that description field is included when ticket has body content
exec ko ls --json --status open
stdout '"id": "json-0004"'
stdout '"description":'
stdout 'This ticket has a body description'

-- .ko/tickets/json-0001.md --
---
id: json-0001
status: open
deps: []
created: 2026-01-01T00:00:00Z
type: task
priority: 2
---
# First JSON ticket
-- .ko/tickets/json-0002.md --
---
id: json-0002
status: open
deps: [json-0003]
created: 2026-01-01T00:00:00Z
type: task
priority: 2
---
# Blocked JSON ticket
-- .ko/tickets/json-0003.md --
---
id: json-0003
status: open
deps: []
created: 2026-01-01T00:00:00Z
type: task
priority: 2
---
# Blocker ticket
-- .ko/tickets/json-0004.md --
---
id: json-0004
status: open
deps: []
created: 2026-01-01T00:00:00Z
type: task
priority: 2
---
# Ticket with description

This ticket has a body description that should appear in the JSON output.
