# Add a note to ticket
exec ko note note-0001 'This is my note'
stdout 'Note added'
exec ko show note-0001
stdout '## Notes'
stdout 'This is my note'

# Note has timestamp
stdout '[0-9]{4}-[0-9]{2}-[0-9]{2}'

# Add note to non-existent ticket
! exec ko note nonexistent 'My note'
stderr 'not found'

# Add multiline note via stdin (echo with newlines)
stdin input_multiline.txt
exec ko note note-0001
stdout 'Note added'
exec ko show note-0001
stdout 'First line'
stdout 'Second line'
stdout 'Third line'

# Add note via heredoc pattern
stdin heredoc_input.txt
exec ko note note-0001
stdout 'Note added'
exec ko show note-0001
stdout 'Line one'
stdout 'Line two'
stdout 'Line three'

# Stdin takes precedence over args
stdin stdin_input.txt
exec ko note note-0001 'This should be ignored'
stdout 'Note added'
exec ko show note-0001
stdout 'From stdin'
! stdout 'This should be ignored'

# Empty stdin falls back to args (terminal mode)
exec ko note note-0001 'From command line'
stdout 'Note added'
exec ko show note-0001
stdout 'From command line'

# Backward compatibility: add-note still works
exec ko add-note note-0001 'Backward compat test'
stdout 'Note added'
exec ko show note-0001
stdout 'Backward compat test'

-- input_multiline.txt --
First line
Second line
Third line
-- heredoc_input.txt --
Line one
Line two
Line three
-- stdin_input.txt --
From stdin
-- .ko/tickets/note-0001.md --
---
id: note-0001
status: open
deps: []
created: 2026-01-01T00:00:00Z
type: task
priority: 2
---
# Test ticket
