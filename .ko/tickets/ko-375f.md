---
id: ko-375f
status: blocked
deps: []
created: 2026-02-24T15:44:43Z
type: task
priority: 2
plan-questions:
  - id: q1
    question: "How should shell harnesses receive and pass the prompt to the agent?"
    context: "The plan notes that different agents have different affordances. Task 2 (claude.sh) uses stdin for prompt, Task 3 (cursor.sh) uses -p argument. Need to clarify the general pattern and whether both methods are supported."
    options:
      - label: "Environment variable only (KO_PROMPT)"
        value: env_var_only
        description: "All scripts receive prompt via KO_PROMPT environment variable and construct their own arguments"
      - label: "Stdin only"
        value: stdin_only
        description: "Shell adapter pipes prompt to stdin; scripts don't use KO_PROMPT for prompt content"
      - label: "Per-harness choice (documented in script)"
        value: per_harness
        description: "Each shell script decides how to use KO_PROMPT (stdin, -p argument, environment variable, etc.) based on the agent's requirements"
---
# Migrate agent harnesses from YAML templates to shell scripts


## Notes

**2026-02-25 04:03:14 UTC:** Question: What is the primary motivation for migrating from YAML to shell scripts?
Answer: Underlying agent harnesses have different syntax and affordances; using shell scripts is how we can ensure the agent invocation intent carries through, regardless of the actual agent harness

**2026-02-25 04:05:10 UTC:** Question: Which architecture should the implementation use?
Answer: Executable wrapper, though env vars should all be KO_ namespaced

**2026-02-25 04:05:10 UTC:** Question: Should YAML harnesses continue to work after migration?
Answer: Replace: Convert YAML to shell and deprecate YAML
Migrate built-in and user harnesses to shell; YAML support is removed

**2026-02-25 04:05:10 UTC:** Question: Should binary fallback logic stay in Go or move to shell?
Answer: Move to shell: Shell handles fallback logic
Shell scripts use command -v or similar to find the binary
