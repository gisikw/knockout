---
id: ko-375f
status: blocked
deps: []
created: 2026-02-24T15:44:43Z
type: task
priority: 2
plan-questions:
  - id: q1
    question: "What is the primary motivation for migrating from YAML to shell scripts?"
    context: "Understanding the design intent will inform all downstream decisions."
    options:
      - label: "Simpler syntax for custom harnesses"
        value: simpler_syntax
        description: "Shell scripts are more intuitive for users to write than YAML templates"
      - label: "More flexible command construction"
        value: flexible_construction
        description: "Shell allows dynamic logic, conditionals, and piping that YAML templates cannot express"
      - label: "Better shell pipeline composition"
        value: pipeline_composition
        description: "Shell scripts can be composed into pipelines more naturally"
      - label: "Other (please specify)"
        value: other
        description: "Different rationale"
  - id: q2
    question: "Which architecture should the implementation use?"
    context: "Option A: Shell scripts are invoked as executables with parameters passed via environment variables. Option B: Shell scripts are renderers that output a complete command line for Go to execute. Option C: Shell scripts handle all orchestration including binary resolution and execution."
    options:
      - label: "Option A: Executable wrapper scripts with env vars"
        value: env_var_wrapper
        description: "Go passes params (PROMPT, MODEL, etc.) via env vars to shell scripts that exec the agent CLI"
      - label: "Option B: Shell template renderers"
        value: template_renderer
        description: "Shell scripts output the full command line; Go then executes it"
      - label: "Option C: Full delegation to shell"
        value: full_delegation
        description: "Shell scripts handle binary resolution, parameter processing, and execution"
  - id: q3
    question: "Should YAML harnesses continue to work after migration?"
    context: "The plan mentions INVARIANTS.md constraint about 'zero external runtime dependencies'. Shell scripts introduce a runtime dependency on a shell interpreter, unless we consider shell universally available."
    options:
      - label: "Coexist: Support both YAML and shell scripts"
        value: coexist
        description: "Both formats work; search order defines priority (e.g., shell scripts first, then YAML)"
      - label: "Replace: Convert YAML to shell and deprecate YAML"
        value: replace
        description: "Migrate built-in and user harnesses to shell; YAML support is removed"
      - label: "Auto-convert: YAML files are automatically converted to shell"
        value: auto_convert
        description: "Tooling converts YAML harnesses to shell scripts; old files may remain but are no longer used"
  - id: q4
    question: "Should binary fallback logic stay in Go or move to shell?"
    context: "Currently YAML harnesses support binary_fallbacks (e.g., try 'claude' then 'claude-4.5'). This can be implemented in Go (before calling shell) or in the shell script itself."
    options:
      - label: "Stay in Go: Resolve binary, pass to shell"
        value: go_resolution
        description: "Go determines the final binary path and passes it to the shell script"
      - label: "Move to shell: Shell handles fallback logic"
        value: shell_resolution
        description: "Shell scripts use command -v or similar to find the binary"
---
# Migrate agent harnesses from YAML templates to shell scripts

