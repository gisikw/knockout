---
id: ko-759a
status: blocked
deps: [ko-8e81]
created: 2026-02-25T05:49:50Z
type: task
priority: 2
---
# ko serve: SSE subscribe endpoint for real-time item updates

Add an SSE (Server-Sent Events) endpoint to ko serve:

    GET /subscribe/{project}

Implementation:
- On connect, immediately send full item list (ko query --json for the project)
- Tail the global events JSONL file (~/.local/state/knockout/events.jsonl)
  for mutations matching this project
- On each matching mutation, re-query and push full item list as an SSE event
- Use standard SSE format: `data: {...}\n\n`
- Include `id:` field on events (monotonic counter or timestamp) so clients
  can send Last-Event-ID on reconnect
- Include `retry: 3000` directive for client reconnection interval
- Multiple concurrent subscribers supported (fan-out from single tail)
- Clean up subscriber on disconnect

The event tailing pattern already exists in punchlist-server/events.go — reference
that implementation for the JSONL tail + fsnotify approach.

Depends on ko-8e81 (base ko serve command).

## Notes

**2026-02-25 06:38:52 UTC:** ko: FAIL at node 'verify' — node 'verify' failed after 3 attempts: command failed: exit status 1
Answered 1 question(s) for test-0001 — 1 question(s) remaining
Answered 2 question(s) for test-0002 — all questions resolved, status set to open
ko answer: invalid JSON: invalid character 'i' looking for beginning of object key string
ko answer: question ID q99 not found in ticket test-0004
ko answer: ticket test-0005 has no plan-questions
initialized .ko/config.yaml
  .ko/prompts/triage.md
  .ko/prompts/implement.md
  .ko/prompts/review.md
ko agent init: /tmp/TestCmdBuildInit_refusesOverwrite226249190/001/.ko/config.yaml already exists
initialized .ko/config.yaml
  .ko/prompts/triage.md
  .ko/prompts/implement.md
  .ko/prompts/review.md
test-a258
test-f743
test-9dd5
test-f116
test-851a
test-cd9f
test-60cb
test-1bc3
test-55e7
test-e195
test-7191
test-82b6
test-8faa
test-5823
initialized /tmp/TestCmdInit175102464/001 with prefix "myp"
initialized /tmp/TestCmdInitAlreadyInitialized3853597272/001 with prefix "abc"
ko init: already initialized with prefix "abc" (in config.yaml)
ko init: prefix must be at least 2 characters
ko init: prefix argument required
Usage: ko init <prefix>
--- FAIL: TestSubscribeHandler (5.51s)
    cmd_serve_test.go:508: timeout waiting for follow-up event
--- FAIL: TestSubscribeMultiple (1.00s)
    cmd_serve_test.go:679: subscriber 0 did not receive event
    cmd_serve_test.go:679: subscriber 1 did not receive event
    cmd_serve_test.go:679: subscriber 2 did not receive event
FAIL
FAIL	git.gisi.network/infra/knockout	10.451s
FAIL

